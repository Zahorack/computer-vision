if isunix
    videoReader = VideoReader('tennis_ball_motion.ogv')
elseif ispc
    videoReader = VideoReader('tennis_ball_motion.avi')
end

hsvframe = HsvFrame;
    
videoWriter = VideoWriter('newfile')
videoWriter.FrameRate = 10;
open(videoWriter);

%  HueHigh = 130/255;
%  HueLow = 40/255;
%  SaturationHigh = 210/255;
%  SaturationLow = 50/255;
%  ValueHigh = 210/255;
%  ValueLow = 50/255;

  HueHigh = 90/255;
  HueLow = 40/255;
  SaturationHigh = 230/255;
  SaturationLow = 30/255;
  ValueHigh = 250/255;
  ValueLow = 10/255;

[x,y,c]=size(rgb2hsv(readFrame(videoReader)));
segment = zeros(x,y,c); 

while hasFrame(videoReader)
    frame = readFrame(videoReader);
    hsvframe.update(rgb2hsv(frame));
    

    segment(:,:,1) = segmentation(hsvframe.hue(), HueLow, HueHigh);
    segment(:,:,2) = segmentation(hsvframe.saturation(), SaturationLow, SaturationHigh);
    segment(:,:,3) = segmentation(hsvframe.value(), ValueLow, ValueHigh);
    
    
    %vytvori sa maska
    mask1=(segment(:,:,1) & segment(:,:,2) & segment(:,:,3));
    %dialtacia a erozia
    se = strel('disk',5);
    mask2=imclose(mask1,se);
    mask3=repmat(1-imopen(mask2,se), 1, 1, 3);
    %zobrazi frame vynasobeny maskou
    

    
%      frame = frame.*uint8(mask2);

      frame(:,:,1) = frame(:,:,1) + uint8(mask1).*250;
%     imshow(frame.*uint8(mask3));
    
    
     [x,y] = centerOfMass(mask1);
     if(x >25 && y > 25)
         objectImage = insertShape(frame,'Rectangle',[(x-25) (y-25) 50 50],'Color','red');
         objectImage = insertText(objectImage,[x-20, y-50],'Target','BoxOpacity',0.1,'BoxColor', 'red', 'TextColor', 'black');
         imshow(objectImage, [])
     end
    
    writeVideo(videoWriter, hsvframe.get());
end

close(videoWriter)



function mask = segmentation(frame, low, high)
    mask = frame > low & frame < high;
end

function [xcentre, ycentre] = centerOfMass(img)
    [x, y] = meshgrid(1:size(img, 2), 1:size(img, 1));
    weightedx = x .* img;
    weightedy = y .* img;
    xcentre = round(sum(weightedx(:)) / sum(img(:)));
    ycentre = round(sum(weightedy(:)) / sum(img(:)));
end
